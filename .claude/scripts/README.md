# 配置管理脚本

## verify-config.sh

配置一致性检查脚本，用于验证所有配置文件中的路径引用是否与模板目录结构保持一致。

### 功能特性

- ✅ 自动扫描所有配置文件
- ✅ 检测旧命名模式（如 `01_案件分析`）
- ✅ 显示详细的错误位置和上下文
- ✅ 支持自动修复模式（带备份）
- ✅ 可检查单个文件或全部文件
- ✅ 提供清晰的报告和统计

### 使用方法

#### 1. 基本检查

检查所有配置文件：
```bash
./verify-config.sh
```

#### 2. 详细检查

显示详细过程：
```bash
./verify-config.sh --verbose
```

#### 3. 检查单个文件

只检查指定的文件：
```bash
./verify-config.sh --check CLAUDE.md
./verify-config.sh --check .claude/tools/pdf_processor.md
```

#### 4. 自动修复

**⚠️ 危险操作！** 自动修复找到的问题（会创建备份）：
```bash
./verify-config.sh --fix
```

#### 5. 修复单个文件

只修复指定文件：
```bash
./verify-config.sh --check CLAUDE.md --fix
```

### 输出示例

#### 检查通过

```
====================================
 SuitAgent 配置一致性检查
====================================

正在加载模板目录结构...
✓ 加载了 12 个标准目录:
  00 - 📅 日程管理
  01 - 🤝 委托材料
  02 - 📄 案件分析
  ...

开始检查配置文件...

检查模板文件...

====================================
 检查完成
====================================

✓ 恭喜！所有配置都一致，没有发现任何问题。
```

#### 发现问题

```
====================================
 SuitAgent 配置一致性检查
====================================

正在加载模板目录结构...
✓ 加载了 12 个标准目录

开始检查配置文件...

检查: /path/to/CLAUDE.md
✗ 发现旧命名: 01_案件分析
  文件: /path/to/CLAUDE.md
  匹配行:
    656:│   ├── 01_案件分析/             # DocAnalyzer + Strategist输出
    747:| **起诉状** | "原告"、"被告" | `01_案件分析/` |

检查: /path/to/.claude/tools/pdf_processor.md
✗ 发现旧命名: 01_案件分析
  文件: /path/to/.claude/tools/pdf_processor.md
  匹配行:
    239:output_dir = "output/[案件编号]/01_案件分析/"

====================================
 检查完成
====================================

检查结果:
  错误: 16
  警告: 0

建议: 运行带 --fix 参数的命令自动修复错误
  ./verify-config.sh --fix
```

#### 自动修复

```
====================================
 SuitAgent 配置一致性检查
====================================

警告: 自动修复会修改配置文件，是否继续？(y/n)
y

正在加载模板目录结构...
✓ 加载了 12 个标准目录

开始检查配置文件...
...

开始修复...

警告: 尝试修复: /path/to/CLAUDE.md
  ✓ 替换: 01_案件分析 → 02 - 📄 案件分析
  ✓ 替换: 02_法律研究 → 03 - 🔍 法律研究
  ✓ 替换: 03_证据材料 → 05 - 📎 证据材料
  ...
修复了 10 处问题

警告: 尝试修复: /path/to/.claude/tools/pdf_processor.md
  ✓ 替换: 01_案件分析 → 02 - 📄 案件分析
修复了 3 处问题

修复完成！
```

### 工作原理

1. **加载标准目录**：从 `.claude/templates/case-templates/` 读取当前正确的目录结构
2. **定义旧模式**：维护一个旧命名到新命名的映射表
3. **扫描文件**：检查所有配置文件中是否包含旧命名
4. **生成报告**：显示具体文件、行号、匹配内容
5. **可选修复**：使用 `sed` 命令自动替换（带备份）

### 检查的文件

脚本默认检查以下配置文件：

- `CLAUDE.md`（核心指导文件）⚠️ 最高优先级
- `.claude/tools/pdf_processor.md`（工具配置）
- `.claude/memory/README.md`（文档说明）
- `.claude/templates/README.md`（文档说明）
- `.claude/agents/*.md`（所有Agent配置）

### 旧命名映射表

| 旧命名 | 新命名 |
|--------|--------|
| 01_案件分析 | 02 - 📄 案件分析 |
| 02_法律研究 | 03 - 🔍 法律研究 |
| 03_证据材料 | 05 - 📎 证据材料 |
| 04_法律文书 | 06 - 📝 法律文书 |
| 05_综合报告 | 10 - 📊 综合报告 |
| 06_日程管理 | 00 - 📅 日程管理 |

### 集成到开发流程

建议在以下场景中运行此脚本：

1. **提交代码前**：确保配置一致性
2. **修改模板后**：检查是否需要更新引用
3. **定期（每周）**：预防配置漂移
4. **创建新案件前**：确保模板正确

### Git 集成

可以添加到 Git Hook：

```bash
# .git/hooks/pre-commit
#!/bin/bash
./.claude/scripts/verify-config.sh
if [ $? -ne 0 ]; then
  echo "配置检查失败，请修复后再提交"
  exit 1
fi
```

### 注意事项

- ⚠️ `--fix` 模式会**修改原始文件**，请务必先提交代码
- ✅ 修复前会自动创建备份（`文件名.bak.时间戳`）
- ⚠️ 修复后需要人工检查，确保替换没有破坏格式
- ✅ 建议修复后运行 `git diff` 查看变更

### 相关文件

- [模板目录说明](../templates/README.md)
- [系统架构文档](../../docs/ARCHITECTURE.md)
- [CLAUDE.md](../../../CLAUDE.md)

### 更新日志

| 版本 | 日期 | 更新内容 |
|------|------|----------|
| v1.0 | 2025-05-19 | 初始版本 |

### 联系方式

如有问题或建议，请更新此文档并提交更改。
