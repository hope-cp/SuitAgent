# 目录结构优化说明

> 版本: v1.0
> 优化日期: 2025-11-14
> 目标: 减少不必要的上下文污染，提高系统性能

## 优化背景

### 问题
- `.claude/memory/` 目录中的文件默认会被加载到上下文中
- 大文件和可引用文件占用过多上下文空间
- 导致响应速度慢、成本高

### 原则
- ✅ 减少memory目录中的文件数量
- ✅ 将可引用文件移到合适位置
- ✅ 保持功能完整性的同时优化性能

## 新的目录结构

```
SuitAgent/
├── .claude/
│   ├── agents/              # Agent配置 ✓ 需要上下文
│   ├── tools/               # 工具代码 ✓ 通过路径引用
│   │   ├── placeholder_mapper.py
│   │   ├── DocxProcessor.py
│   │   ├── docx_tools.py
│   │   ├── pdf_processor.py
│   │   ├── standards/       # 质量标准 ✓ 移到tools
│   │   └── docxformats/     # Word格式 ✓ 移到tools
│   ├── templates/           # 模板目录 ✓ 统一管理
│   │   ├── 公司委托模板/     # 9个Word模板
│   │   └── 个人委托模板/     # 8个Word模板
│   ├── workflows/           # 工作流文档 ✓ 需要上下文
│   └── memory/              # 精简后的memory ✓ 只保留必要文件
│       └── integration/     # 整合文档
│
├── docs/                    # 项目文档 ✓ 移到docs
│   ├── ARCHITECTURE.md
│   ├── legal_deadlines.md   # 法律期限 ✓ 移到docs
│   └── legal_templates.md   # 法律模板 ✓ 移到docs
│
├── output/                  # 输出目录
│   └── templates/           # 案例模板 ✓ 移到output
│       ├── [案件编号].md
│       └── 01-06_*/         # 各阶段模板
│
└── tests/                   # 测试文件 ✓ 保持不变
```

## 文件移动清单

### ✅ 已移动

| 源位置 | 目标位置 | 文件类型 | 原因 |
|--------|----------|----------|------|
| `.claude/memory/case-template/` | `output/templates/` | 案例模板 | 通过路径引用，无需上下文 |
| `.claude/memory/standards/` | `.claude/tools/standards/` | 质量标准 | 可引用，工具相关 |
| `.claude/memory/docxformats/` | `.claude/tools/docxformats/` | Word格式 | 可引用，工具相关 |
| `.claude/memory/legal_deadlines.md` | `docs/legal_deadlines.md` | 法律文档 | 项目文档，可引用 |
| `.claude/memory/legal_templates.md` | `docs/legal_templates.md` | 法律文档 | 项目文档，可引用 |
| `.claude/memory/公司委托模板/` | `.claude/templates/公司委托模板/` | Word模板 | 统一管理模板 |
| `.claude/memory/个人委托模板/` | `.claude/templates/个人委托模板/` | Word模板 | 统一管理模板 |

### ✅ 保留在memory

| 目录 | 内容 | 保留原因 |
|------|------|----------|
| `.claude/memory/integration/` | 整合文档 | 需要上下文说明 |
| `.claude/memory/workflows/` | 工作流文档 | Agent需要读取 |

## 性能提升

### 上下文大小优化

**优化前**:
- memory目录: 约50+文件
- 上下文大小: ~500KB (估算)

**优化后**:
- memory目录: 约20文件
- 上下文大小: ~200KB (估算)
- **减少: 60%**

### 文件访问优化

**优化前**:
```
所有文件 → 自动加载到上下文 → 可能超时
```

**优化后**:
```
必要文件 → 仅加载必要文件
可引用文件 → 按需读取，不占用上下文
```

## 使用指南

### 引用工具代码
```python
from .claude.tools.docx_tools import batch_generate_trust_documents
from .claude.tools.placeholder_mapper import PlaceholderMapper
from .claude.tools.DocxProcessor import DocxProcessor
```

### 引用模板
```python
template_dir = ".claude/templates/公司委托模板"
template_path = os.path.join(template_dir, "委托合同.docx")
```

### 引用案例模板
```python
from pathlib import Path
case_template = "output/templates/[案件编号].md"
```

### 引用标准文档
```python
standards_path = ".claude/tools/standards/QUALITY_REVIEW_STANDARDS.md"
```

## 更新文档引用

以下文档中的路径需要更新：

- [x] `.claude/tools/docx_tools.py` - 已更新
- [x] `.claude/memory/integration/字段对照表.md` - 已更新
- [x] `.claude/memory/integration/工具使用指南.md` - 已更新
- [x] `.claude/memory/integration/委托确定工作流.md` - 已更新
- [x] `.claude/memory/integration/整合工作总结.md` - 已更新

## 检查清单

- [x] 工具代码全部移至 `.claude/tools/`
- [x] 模板文件移至 `.claude/templates/`
- [x] 案例模板移至 `output/templates/`
- [x] 标准文档移至 `.claude/tools/standards/`
- [x] Word格式移至 `.claude/tools/docxformats/`
- [x] 法律文档移至 `docs/`
- [x] memory目录精简至必要文件
- [x] 所有路径引用已更新

## 注意事项

### 1. 导入路径
工具代码使用相对导入：
```python
from .DocxProcessor import DocxProcessor
from .placeholder_mapper import PlaceholderMapper
```

### 2. 文件读取
所有文件都通过绝对路径或相对路径引用，不依赖memory自动加载。

### 3. 上下文文件
只有真正需要给上下文的文件才放在memory中。

## 未来优化建议

1. **进一步精简workflows** - 只保留必要的说明文档
2. **模块化Agent配置** - 按需加载Agent配置
3. **动态上下文** - 根据任务动态加载相关内容

---

**优化完成**: 2025-11-14
**性能提升**: 约60%上下文大小减少
**状态**: ✅ 完成
